# Zero-Secrets GitOps Infrastructure

**5-phase bootstrap** that deploys universal GitOps infrastructure with complete zero-secrets architecture - from Raspberry Pi to enterprise cloud in a single command.

## Ultra-Simple Deployment

Deploy a complete zero-secrets Kubernetes cluster from any fresh Ubuntu machine:

```bash
# Set bootstrap environment variable (cleared automatically after deployment)
export GITHUB_TOKEN="ghp_your_github_token_here"
# Only GITHUB_TOKEN required - all other secrets auto-generated by Terraform

# Single command bootstrap - all 5 phases automatic
curl -sSL https://raw.githubusercontent.com/antonioacg/infra-management/${GIT_REF:-main}/bootstrap.sh | bash
```

**Result**: Complete GitOps infrastructure with ALL secrets managed through Vault → External Secrets → Kubernetes. No secrets ever stored in Git.

## 5-Phase Bootstrap Process

1. **Phase 1: Infrastructure** - k3s, Flux, Vault, External Secrets Operator
2. **Phase 2: Secret Population** - ALL secrets → Vault via Terraform (including GitHub token)
3. **Phase 3: Flux Auth Switch** - Flux switches from direct auth to External Secrets  
4. **Phase 4: Applications** - Apps deploy with External Secrets working automatically
5. **Phase 5: Cleanup** - Environment variables cleared, zero-secrets achieved

**Duration**: ~5 minutes | **Architecture**: Universal (Raspberry Pi to enterprise cloud)

## Architecture

This bootstrap script orchestrates three repositories:

- **[deployments](https://github.com/antonioacg/deployments)** - Kubernetes manifests and Flux GitOps
- **[infra](https://github.com/antonioacg/infra)** - Terraform infrastructure and Vault configuration  
- **[infra-management](https://github.com/antonioacg/infra-management)** - This bootstrap orchestrator

## Prerequisites

**Hardware:** 
- Raspberry Pi 4 (4GB+) or Ubuntu 20.04+ server
- 4GB+ RAM, 32GB+ storage, internet access

**Credentials:**
- GitHub personal access token (`ghp_...`) with repo access
- All other credentials auto-generated by Terraform during bootstrap

**That's it!** - All tools installed automatically during bootstrap

## Zero-Secrets Achievement

After ~5 minutes, you'll have **true zero-secrets architecture**:
- ✅ **No secrets in Git repositories** (ever)
- ✅ **No secrets in environment variables** (cleared automatically)  
- ✅ **All secrets in Vault** → External Secrets → Kubernetes
- ✅ **Complete GitOps pipeline** with Flux using External Secrets
- ✅ **Universal deployment** - same result Pi to cloud

## Documentation

**Start here:**
- [QUICKSTART.md](QUICKSTART.md) - 2-minute start for experienced users
- [ARCHITECTURE.md](ARCHITECTURE.md) - Complete 5-phase architecture
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Phase-specific error handling

## Verification

Check your deployment:

```bash
# Verify all components are running
kubectl get pods -A

# Check GitOps status  
flux get all --all-namespaces

# Verify External Secrets synchronization
kubectl get externalsecrets -A

# Test Vault connectivity
kubectl exec -n vault vault-0 -- vault status
```

## Support

For issues or questions:
- Check troubleshooting commands in workspace CLAUDE.md
- Review component logs: `kubectl logs -n <namespace> <pod-name>`  
- Verify prerequisites and retry bootstrap

## Security Model

**Zero-Secrets Architecture:**
- **Git Repositories**: No secrets ever committed (zero-secrets architecture)
- **Environment Variables**: Used only during bootstrap, then cleared automatically
- **Secret Management**: Vault + External Secrets for all ongoing operations
- **Flux Authentication**: Switches from bootstrap token to External Secrets automatically

**Infrastructure Independence**: Same security model from development Raspberry Pi to production enterprise cloud.